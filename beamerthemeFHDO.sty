% LaTeX-Beamer Theme that replicates the style guide, corporate design and PPT-Template of 
% https://www.fh-dortmund.de 
% 
% Code by Claus Vormann, (c) 2022
% This code is distributable with one of the following licences:
% CC-BY 4.0 https://creativecommons.org/licenses/by/4.0/
% LPPL https://www.latex-project.org/lppl/
%
% The code is partially based on:
% https://rlog.rgtti.com/2019/09/21/make-your-own-beamer-style-ducks/
% https://tex.stackexchange.com/questions/146529/design-a-custom-beamer-theme-from-scratch
% https://tex.stackexchange.com/questions/26299/how-does-beamer-build-the-frame
% ...and several other ideas on tex.stackexchange.com
%
% Thanks to ... for very useful hints.
%


\mode<presentation>

% Load the required packages
\RequirePackage{tikz}
\RequirePackage{fontspec}
\RequirePackage{changepage}
\usetikzlibrary{backgrounds,positioning,fit}


% Settings
\useinnertheme{FHDO}
\useoutertheme{FHDO}
\usecolortheme{FHDO}



\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{blocks}[rounded][shadow=true]  

\pgfkeys{/FHDO/.cd,
  usetitleprogressbar/.code=\pgfkeysalso{outer/progressbar=frametitle},
  noslidenumbers/.code=\pgfkeysalso{outer/numbering=none},
  usetotalslideindicator/.code=\pgfkeysalso{outer/numbering=fraction},
  nosectionslide/.code=\pgfkeysalso{inner/sectionpage=none},
  darkcolors/.code=\pgfkeysalso{color/background=dark},
  blockbg/.code=\pgfkeysalso{color/block=fill, inner/block=fill},
}

\pgfkeys{
  /FHDO/titleformat/.code=\pgfkeysalso{
      font/titleformat title=#1,
      font/titleformat subtitle=#1,
      font/titleformat section=#1,
      font/titleformat frame=#1,
      titleformat plain=#1,
    }
}

% Declare the required pgf layery

\pgfdeclarelayer{background}
\pgfdeclarelayer{middle}
\pgfdeclarelayer{main}
\pgfdeclarelayer{forground}
\pgfsetlayers{background, middle, main, forground}

\mode<all>

% Declare the CD required font MetaOfficePro as the main font to be used

\setsansfont[
            BoldFont = MetaOffcPro-Bold.ttf,
            ItalicFont = MetaOffcPro-NormIta.ttf,
            BoldItalicFont = MetaOffcPro-BoldIta.ttf
            ]
            {MetaOffcPro-Norm.ttf}

% Declare the font styles to be used in the presentation

\setbeamerfont{footnote}{size=\tiny}
\setbeamerfont{author}{size=\tiny}
\setbeamerfont{title}{size=\LARGE,series=\bfseries}
\setbeamerfont{subtitle}{size=\normalsize,series=\mdseries}
\setbeamerfont{frametitle}{size=\Large,series=\bfseries}
\setbeamerfont{section in title}{size=\normalsize,series=\mdseries}

%  Set the size of the main text field.
\setbeamersize{text margin left=3.9cm,text margin right=2em}



% Format the footnotes
% by (un)commenting the first line, the Footnote-Number can be switched on or off

\renewcommand*{\@makefnmark}{}
\renewcommand\footnoterule{}
\setbeamerfont{footnote}{size=\tiny}

% Format the block environment


\setbeamertemplate{blocks}[default]


% Alles rund um Übungen -- Übernommen und angepasst vom FOM Layout

\setbeamercolor{frametitle in head exercise}{parent=myheader, bg=FHDOTitelColor, fg=white}
\setbeamerfont{myheader}{}
\setbeamerfont{frametitle in head exercise}{parent=myheader}

% ---------------------------------------------------------------------------
%
% Übungen und sollen einen etwas anderen Hintergrund beim Frametitle haben. 
% Hier wird ein Schalter dazu erzeugt und und auf die normale Darstellun (false) gesetzt.
%
\newif\ifFHDOexercisemode
\FHDOexercisemodefalse
%  \FHDOexercisemodetrue

% ---------------------------------------------------------------------------
% Sind wir gerade in einer Notes Umgebung oder nicht?
%
\newif\ifnotesmode
\notesmodefalse

% ---------------------------------------------------------------------------
%
% Note page (default) updated!
%
\newsavebox{\mytempbox}
\defbeamertemplate{note page}{custom}
{\notesmodetrue
  {%
    \scriptsize
    \usebeamerfont{note title}\usebeamercolor[fg]{note title}%
    \ifbeamercolorempty[bg]{note title}{}{%
      \insertvrule{.25\paperheight}{note title.bg}%
      \vskip-.25\paperheight%
      \nointerlineskip%
    }%
    \vbox{%
      \hspace*{.6875\paperwidth}\insertslideintonotes{0.25}%
      \vskip-0.25\paperheight%
      \nointerlineskip
      \begin{pgfpicture}{0cm}{0cm}{0cm}{0cm}
        \begin{pgflowlevelscope}{\pgftransformrotate{90}}
          {\pgftransformshift{\pgfpoint{-2cm}{0.2cm}}%
          \pgftext[base,left]{\usebeamerfont{note date}\usebeamercolor[fg]{note date}\the\year-\ifnum\month<10\relax0\fi\the\month-\ifnum\day<10\relax0\fi\the\day}}
        \end{pgflowlevelscope}
      \end{pgfpicture}
    }%
    \nointerlineskip
    \vbox to .25\paperheight{\vskip0.5em
     \hbox{\insertshorttitle[width=8cm]}%
     \setbox\mytempbox=\hbox{\insertsection}%
     \hbox{\ifdim\wd\mytempbox>1pt{\hskip4pt\raise3pt\hbox{\vrule
           width0.4pt height7pt\vrule width 9pt
           height0.4pt}}\hskip1pt\hbox{\begin{minipage}[t]{7.5cm}\def\breakhere{}\insertsection\end{minipage}}\fi%
      }%
      \setbox\mytempbox=\hbox{\insertsubsection}%
      \hbox{\ifdim\wd\mytempbox>1pt{\hskip17.4pt\raise3pt\hbox{\vrule
            width0.4pt height7pt\vrule width 9pt
            height0.4pt}}\hskip1pt\hbox{\begin{minipage}[t]{7.5cm}\def\breakhere{}\insertsubsection\end{minipage}}\fi%
      }%
      \setbox\mytempbox=\hbox{\insertshortframetitle}%
     % \hbox{\ifdim\wd\mytempbox>1pt{\hskip30.8pt\raise3pt\hbox{\vrule
     %       width0.4pt height7pt\vrule width 9pt
     %       height0.4pt}}\hskip1pt\hbox{\insertshortframetitle[width=7cm]}\fi%
     % }%
      \vfil}%
  }%
  \ifbeamercolorempty[bg]{note page}{}{%
    \nointerlineskip%
    \insertvrule{.75\paperheight}{note page.bg}%
    \vskip-.75\paperheight%
  }%
  \vskip.25em
  \nointerlineskip
  %
  %\textwidth=10.8cm%
  \textwidth=13.8cm%
  \hsize=\textwidth%
  %
  \insertnote\notesmodefalse
}


\setbeamertemplate{note page}[custom]

% ---------------------------------------------------------------------------
% Exercise Counter
%
\newcounter{exerciseCounter}
\newcommand{\nextExercise}{\ifnotesmode{\relax}\else{\stepcounter{exerciseCounter}}\fi\theexerciseCounter}
\newcommand{\thisExercise}{\theexerciseCounter}

% ---------------------------------------------------------------------------
% Assignment Counter
%
\newcounter{assignmentCounter}
\newcommand{\nextAssignment}{\ifnotesmode{\relax}\else{\stepcounter{assignmentCounter}}\fi\theassignmentCounter}
\newcommand{\thisAssignment}{\theassignmentCounter}